<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: MainView.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: MainView.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @file MainView.jsx
 * @description Main component of the myFlix app that handles routing, state management, and user authentication. This component is responsible for rendering the main view, managing logged-in users, and providing different routes for movies, user profile, and more.
 */

import React, { useState, useEffect } from 'react';
import { LoginView } from '../LoginView/LoginView';
import { SignupView } from '../SignupView/SignupView';
import { MovieView } from '../MovieView/MovieView';
import { MovieCard } from '../MovieCard/MovieCard';
import { ProfileView } from '../ProfileView/ProfileView';
import { Routes, Route, Navigate, useLocation } from 'react-router-dom';
import NavigationBar from '../Navigation-Bar/Navigation-Bar.jsx';
import Row from 'react-bootstrap/Row';
import Col from 'react-bootstrap/Col';
import './MainView.scss';

/**
 * Main component that handles the entire layout and routing for myFlix app.
 * @component
 */
export const MainView = () => {
  const storedUser = JSON.parse(localStorage.getItem('user'));
  const storedToken = localStorage.getItem('token');
  
  /** @type {[Object, Function]} User state and its setter */
  const [user, setUser] = useState(storedUser ? storedUser : null);
  
  /** @type {[string, Function]} Token state and its setter */
  const [token, setToken] = useState(storedToken ? storedToken : null);
  
  /** @type {[Array, Function]} Movies state for storing movie list */
  const [movies, setMovies] = useState([]);
  
  /** @type {[Array, Function]} Favorites state for storing user favorite movies */
  const [favorites, setFavorites] = useState(user ? user.FavoriteMovies : []);
  
  /** @type {[string, Function]} Search term state for storing user input */
  const [searchTerm, setSearchTerm] = useState('');
  
  /** @type {[Array, Function]} SimilarMovies state for storing similar movies */
  const [similarMovies, setSimilarMovies] = useState([]);
  
  const location = useLocation(); // Hook to get the current route

  /**
   * useEffect hook to fetch all movies when a token is available.
   */
  useEffect(() => {
    if (!token) return;

    fetch('https://my-movie-flix-777-b5447997dd22.herokuapp.com/movies', {
      headers: { Authorization: `Bearer ${token}` },
    })
      .then((response) => {
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        return response.json();
      })
      .then((data) => {
        const moviesFromApi = data.map((movie) => ({
          id: movie._id,
          title: movie.Title,
          description: movie.Description,
          imagePath: movie.ImagePath,
          genre: movie.Genre.Name,
          director: movie.Director.Name,
        }));
        setMovies(moviesFromApi);
      })
      .catch((error) => {
        console.error('Error fetching movies:', error);
      });
  }, [token]);

  /**
   * Handles user logout.
   * Clears user and token from state and local storage.
   */
  const handleLogout = () => {
    setUser(null);
    setToken(null);
    localStorage.clear();
  };

  /**
   * Handles updating user data.
   * @param {Object} updatedUser - The updated user data.
   */
  const handleUpdateUser = (updatedUser) => {
    setUser(updatedUser);
    localStorage.setItem('user', JSON.stringify(updatedUser));
  };

  /**
   * Handles user deregistration.
   */
  const handleDeregisterUser = () => {
    console.log('Deregistering user');
  };

  /**
   * Adds a movie to the user's favorites list.
   * Updates both the state and local storage.
   * @param {string} movieId - ID of the movie to be added to favorites.
   */
  const handleAddFavorite = (movieId) => {
    const updatedFavorites = [...favorites, movieId];
    setFavorites(updatedFavorites);
    setUser({ ...user, FavoriteMovies: updatedFavorites });
    localStorage.setItem('user', JSON.stringify({ ...user, FavoriteMovies: updatedFavorites }));

    fetch(`https://my-movie-flix-777-b5447997dd22.herokuapp.com/users/${user.Username}/movies/${movieId}`, {
      method: 'POST',
      headers: { Authorization: `Bearer ${token}` },
    });
  };

  /**
   * Removes a movie from the user's favorites list.
   * Updates both the state and local storage.
   * @param {string} movieId - ID of the movie to be removed from favorites.
   */
  const handleRemoveFavorite = (movieId) => {
    const updatedFavorites = favorites.filter(id => id !== movieId);
    setFavorites(updatedFavorites);
    setUser({ ...user, FavoriteMovies: updatedFavorites });
    localStorage.setItem('user', JSON.stringify({ ...user, FavoriteMovies: updatedFavorites }));

    fetch(`https://my-movie-flix-777-b5447997dd22.herokuapp.com/users/${user.Username}/movies/${movieId}`, {
      method: 'DELETE',
      headers: { Authorization: `Bearer ${token}` },
    });
  };

  /**
   * Fetches similar movies for a given movie.
   * @param {string} movieId - ID of the movie to fetch similar movies for.
   */
  const fetchSimilarMovies = (movieId) => {
    fetch(`https://my-movie-flix-777-b5447997dd22.herokuapp.com/movies/${movieId}/similar`, {
      headers: { Authorization: `Bearer ${token}` },
    })
      .then((response) => {
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        return response.json();
      })
      .then((data) => {
        const similarMoviesFromApi = data.map((movie) => ({
          id: movie._id,
          title: movie.Title,
          description: movie.Description,
          imagePath: movie.ImagePath,
          genre: movie.Genre.Name,
          director: movie.Director.Name,
        }));
        setSimilarMovies(similarMoviesFromApi);
      })
      .catch((error) => {
        console.error('Error fetching similar movies:', error);
      });
  };

  /** Filtered movies based on search term */
  const filteredMovies = movies.filter(movie =>
    movie.title.toLowerCase().includes(searchTerm.toLowerCase())
  );

  return (
    &lt;div className="main-view">
      &lt;NavigationBar user={user} onLoggedOut={handleLogout} />
      &lt;Row className="justify-content-md-center">
        {location.pathname !== '/profile' &amp;&amp; (
          &lt;input
            type="text"
            className="search-input"
            placeholder="Search for a movie..."
            value={searchTerm}
            onChange={(e) => setSearchTerm(e.target.value)}
          />
        )}
        &lt;Routes>
          &lt;Route
            path="/signup"
            element={
              user ? (
                &lt;Navigate to="/" />
              ) : (
                &lt;Col md={5}>
                  &lt;SignupView />
                &lt;/Col>
              )
            }
          />
          &lt;Route
            path="/login"
            element={
              user ? (
                &lt;Navigate to="/" />
              ) : (
                &lt;Col md={5}>
                  &lt;LoginView onLoggedIn={(user, token) => {
                    setUser(user);
                    setToken(token);
                    setFavorites(user.FavoriteMovies);
                  }} />
                &lt;/Col>
              )
            }
          />
          &lt;Route
            path="/movies/:movieId"
            element={
              !user ? (
                &lt;Navigate to="/login" replace />
              ) : movies.length === 0 ? (
                &lt;Col>The list is empty!&lt;/Col>
              ) : (
                &lt;Col md={8}>
                  &lt;MovieView 
                    movies={movies}
                    addFavorite={handleAddFavorite}
                    removeFavorite={handleRemoveFavorite}
                    favorites={favorites}
                  />
                &lt;/Col>
              )
            }
          />
          &lt;Route
            path="/profile"
            element={
              user ? (
                &lt;ProfileView
                  user={user}
                  movies={movies}
                  onUserUpdate={handleUpdateUser}
                  onUserDeregister={handleDeregisterUser}
                  addFavorite={handleAddFavorite}
                  removeFavorite={handleRemoveFavorite}
                  favorites={favorites}
                />
              ) : (
                &lt;Navigate to="/login" replace />
              )
            }
          />
          &lt;Route
            path="/"
            element={
              !user ? (
                &lt;Navigate to="/login" replace />
              ) : filteredMovies.length === 0 ? (
                &lt;Col>The list is empty!&lt;/Col>
              ) : (
                &lt;>
                  {filteredMovies.map((movie) => (
                    &lt;Col className="mb-4" key={movie.id} md={3}>
                      &lt;MovieCard
                        movie={movie}
                        addFavorite={handleAddFavorite}
                        removeFavorite={handleRemoveFavorite}
                        isFavorite={favorites.includes(movie.id)}
                      />
                    &lt;/Col>
                  ))}
                &lt;/>
              )
            }
          />
        &lt;/Routes>
      &lt;/Row>
    &lt;/div>
  );
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#MainView">MainView</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.3</a> on Fri Oct 11 2024 16:38:39 GMT+0200 (Central European Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
